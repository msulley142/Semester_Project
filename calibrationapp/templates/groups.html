<!--The html template was heavily edited using AI Generated Code -->
{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Groups - Calibration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{% static 'css/base.css' %}">

  <style>
        :root {
      /* --- CALIBRATION THEME --- */
      --bg: #EEEEEE;
      --bg-soft: #C3E4E9;

      --card: #FFFFFF;
      --card-soft: #EAF3F6;

      --accent: #056C89;
      --accent-soft: #88B4BE;
      --accent-strong: #023653;

      --text-main: #022432;
      --text-muted: #4B6770;

      --border-subtle: #C5D4D8;

      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-pill: 999px;

      --shadow-soft: 0 16px 40px rgba(2, 54, 83, 0.18);

      --sidebar-w: 260px;
    }

    *, *::before, *::after { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, sans-serif;
      color: var(--text-main);
      background: var(--bg);
    }

    a { color: inherit; text-decoration: none; }
    button { border: 0; background: none; cursor: pointer; }
    .app-shell {
      display: block; /* override shared grid layout; sidebar is fixed */
      min-height: 100vh;
    }

    /* ---- SIDEBAR (same as dashboard) ---- */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: var(--sidebar-w);
      background: linear-gradient(180deg, #023653 0%, #000000 100%);
      color: #e5e7eb;
      border-right: 1px solid #000000;
      padding: 18px 18px 20px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      z-index: 40;
      box-shadow: 10px 0 30px rgba(0, 0, 0, 0.5);
    }

    @media (max-width: 900px) {
      .sidebar {
        position: static;
        width: 100%;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 14px 16px;
      }
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-mark {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
      display: flex;
      align-items: center;
      justify-content: center;
      color: #f9fafb;
      font-weight: 800;
      font-size: 0.9rem;
      box-shadow: 0 0 0 2px #000000;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .brand-title {
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #F9FAFB;
    }
    .brand-subtitle {
      font-size: 0.72rem;
      color: #D1E2F2;
    }

    /* ---- MAIN LAYOUT ---- */
    .site-main {
      margin-left: var(--sidebar-w);
      background: var(--bg);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    @media (max-width: 900px) {
      .site-main {
        margin-left: 0;
      }
    }

    .site-main-inner {
      display: flex;
      flex-direction: column;
      gap: 24px;
      padding-bottom: 28px;
    }

    /* ---- HEADER ---- */
    .site-header {
      margin: 0 0 18px;
      padding: 14px 24px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid var(--border-subtle);
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 6px 16px rgba(2, 54, 83, 0.08);
    }

    @media (max-width: 640px) {
      .site-header {
        flex-wrap: wrap;
        padding: 12px 16px 10px;
        margin-bottom: 16px;
      }
    }

    .site-header-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .site-header-title h1 {
      margin: 0;
      font-size: 1.18rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent-strong);
    }

    .site-header-title span {
      font-size: 0.86rem;
      color: var(--text-muted);
    }

    .header-actions {
      display: inline-flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .toolbar {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 7px 12px;
      border-radius: var(--radius-pill);
      font-size: 0.8rem;
      font-weight: 500;
      border: 1px solid var(--border-subtle);
      background: #FFFFFF;
      color: var(--text-main);
      cursor: pointer;
      text-decoration: none;
      transition:
        background 0.16s ease,
        border-color 0.16s ease,
        box-shadow 0.16s ease,
        transform 0.12s ease,
        color 0.12s ease;
    }

    .btn:hover {
      background: var(--card-soft);
      border-color: var(--accent-soft);
      box-shadow: 0 8px 20px rgba(2, 54, 83, 0.16);
      transform: translateY(-1px);
    }

    .btn-primary {
      border-color: transparent;
      background: linear-gradient(115deg, var(--accent), var(--accent-strong));
      color: #FFFFFF;
      box-shadow: 0 10px 22px rgba(2, 54, 83, 0.45);
    }

    .btn-primary:hover {
      filter: brightness(1.04);
      box-shadow: 0 12px 26px rgba(2, 54, 83, 0.55);
    }

    .btn-sm {
      padding: 6px 10px;
      font-size: 0.78rem;
    }

    /* PROFILE BUTTON */
    .profile-button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 12px;
      border-radius: 999px;
      background: #FFFFFF;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 6px 16px rgba(2, 54, 83, 0.08);
      transition:
        background 0.16s ease,
        box-shadow 0.16s ease,
        transform 0.12s ease,
        border-color 0.12s ease;
    }

    .profile-button:hover {
      background: var(--card-soft);
      border-color: var(--accent-soft);
      box-shadow: 0 10px 22px rgba(2, 54, 83, 0.16);
      transform: translateY(-1px);
    }

    .avatar-wrap {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      overflow: hidden;
      background: #D1D5DB;
      flex-shrink: 0;
    }

    .avatar-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gear-icon {
      font-size: 18px;
      color: var(--accent);
    }

    /* SECTION WRAPPER */
    .section-shell {
      padding: 0 24px 26px;
      width: 100%;
    }

    @media (max-width: 900px) {
      .section-shell { padding: 0 18px 22px; }
    }

    /* ENTRANCE ANIMATIONS */
    @keyframes fadeInSoft {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .fade-in { animation: fadeInSoft 0.35s ease-out forwards; opacity: 0; }
    .delay-1 { animation-delay: .06s; }
    .delay-2 { animation-delay: .12s; }
    .delay-3 { animation-delay: .18s; }
    /* ---- GROUPS HERO ---- */
    .hero-row {
      margin-top: 6px;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.7fr);
      gap: 20px;
      margin-bottom: 24px;
    }

    @media (max-width: 1024px) {
      .hero-row { grid-template-columns: minmax(0,1fr); }
    }

    .hero-card {
      position: relative;
      border-radius: var(--radius-lg);
      padding: 20px 22px 18px;
      background: radial-gradient(circle at top left,
        rgba(5,108,137,0.92) 0,
        #023653 45%,
        #000000 100%);
      color: #EAF6FA;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
    }

    .hero-card h2 {
      margin: 0 0 6px;
      font-size: 1.2rem;
      color: #FFFFFF;
    }

    .hero-card p {
      margin: 0;
      font-size: 0.9rem;
      color: #EAF6FA;
    }

    .pill-row {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 0.76rem;
    }

    .pill {
      padding: 6px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      background: var(--card-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-main);
    }


    .hero-actions {
      margin-top: 14px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* Quick stats */
    .stats-grid {
      position: relative;
      border-radius: var(--radius-lg);
      padding: 18px 18px 14px;
      background: var(--card);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      align-items: center;
      font-size: 0.82rem;
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-label {
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .stat-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent-strong);
    }

    /* ---- FILTER BAR ---- */
    .filter-bar {
      margin-bottom: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      font-size: 0.86rem;
    }

    .search-wrap {
      display: flex;
      align-items: center;
      background: #FFFFFF;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      padding: 5px 10px;
      gap: 6px;
      min-width: 220px;
      max-width: 320px;
      flex: 1;
    }

    .search-wrap input {
      border: none;
      outline: none;
      width: 100%;
      font-size: 0.86rem;
      background: transparent;
      color: var(--text-main);
    }

    .search-icon {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .filter-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }

    .filter-chip {
      padding: 6px 10px;
      border-radius: var(--radius-pill);
      background: #FFFFFF;
      border: 1px solid var(--border-subtle);
      font-size: 0.78rem;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      transition:
        background 0.14s ease,
        border-color 0.14s ease,
        color 0.14s ease,
        box-shadow 0.14s ease,
        transform 0.12s ease;
    }

    .filter-chip:hover {
      background: var(--card-soft);
      border-color: var(--accent-soft);
      box-shadow: 0 8px 18px rgba(2, 54, 83, 0.14);
      transform: translateY(-1px);
    }

    .filter-chip.active {
      background: var(--accent);
      border-color: transparent;
      color: #FFFFFF;
      box-shadow: 0 10px 22px rgba(2, 54, 83, 0.35);
    }

    /* ---- GROUPS GRID ---- */
    .content-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.4fr);
      gap: 20px;
      align-items: flex-start;
    }

    @media (max-width: 1100px) {
      .content-grid {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .panel-card {
      background: var(--card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 14px 14px 12px;
      position: relative;
      overflow: hidden;
      font-size: 0.86rem;
      transition:
        transform 0.16s ease,
        box-shadow 0.16s ease,
        border-color 0.16s ease,
        background 0.16s ease;
    }

    .panel-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 32px rgba(2, 54, 83, 0.2);
      border-color: var(--accent-soft);
      background: #FFFFFF;
    }

    .panel-card h3 {
      margin: 0 0 4px;
      font-size: 0.98rem;
      color: var(--accent-strong);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-subtitle {
      margin: 0 0 8px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Group list items */
    .group-list {
      margin: 8px 0 0;
      padding: 0;
      list-style: none;
      max-height: 360px;
      overflow-y: auto;
    }

    .group-item {
      border-radius: 12px;
      border: 1px solid #D0DDE5;
      background: var(--card-soft);
      padding: 9px 10px;
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      transition:
        transform 0.12s ease,
        box-shadow 0.12s ease,
        border-color 0.12s ease,
        background 0.12s ease;
    }

    .group-item:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(2, 54, 83, 0.14);
      border-color: var(--accent-soft);
      background: #FFFFFF;
    }

    .group-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .group-name {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .group-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
      font-size: 0.74rem;
      color: var(--text-muted);
    }

    .group-chip {
      padding: 2px 7px;
      border-radius: var(--radius-pill);
      background: #E8F5F8;
      border: 1px solid #C3E4E9;
      color: var(--accent-strong);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .group-meta {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .group-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .group-action-btn {
      padding: 5px 9px;
      border-radius: var(--radius-pill);
      border: 1px solid #D0DDE5;
      background: #FFFFFF;
      font-size: 0.76rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: var(--text-main);
      transition:
        background 0.14s ease,
        border-color 0.14s ease,
        transform 0.12s ease,
        box-shadow 0.14s ease;
    }

    .group-action-btn:hover {
      background: var(--card-soft);
      border-color: var(--accent-soft);
      box-shadow: 0 8px 18px rgba(2, 54, 83, 0.16);
      transform: translateY(-1px);
    }

    .group-action-btn.primary {
      border-color: transparent;
      background: linear-gradient(115deg, var(--accent), var(--accent-strong));
      color: #FFFFFF;
      box-shadow: 0 8px 18px rgba(2, 54, 83, 0.4);
    }

    .group-action-btn.danger {
      background: #FEE2E2;
      border-color: #FECACA;
      color: #B91C1C;
    }

    .group-action-btn.muted {
      background: #F3F4F6;
      color: var(--text-muted);
    }

    .group-empty {
      margin-top: 4px;
      font-size: 0.84rem;
      color: var(--text-muted);
    }

    /* ALL GROUPS GRID */
    .all-groups-grid {
      margin-top: 8px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      max-height: 360px;
      overflow-y: auto;
    }

    @media (max-width: 700px) {
      .all-groups-grid {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .all-group-card {
      border-radius: 12px;
      border: 1px solid #D0DDE5;
      background: var(--card-soft);
      padding: 9px 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.84rem;
      transition:
        transform 0.12s ease,
        box-shadow 0.12s ease,
        border-color 0.12s ease,
        background 0.12s ease;
    }

    .all-group-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(2, 54, 83, 0.14);
      border-color: var(--accent-soft);
      background: #FFFFFF;
    }

    .all-group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .badge-privacy {
      padding: 2px 7px;
      border-radius: var(--radius-pill);
      background: #F3F4F6;
      border: 1px solid #E5E7EB;
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .all-group-desc {
      color: var(--text-muted);
      font-size: 0.78rem;
    }

    .all-group-actions {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .hidden { display: none !important; }

    
    /* PROFILE MODAL OVERRIDE */
    .profile-quick-links h4 { color: var(--accent-strong); }

/* Create group modal spacing */
    .create-modal-form {
      display: flex;
      flex-direction: column;
      gap: 14px;
      width: 100%;
    }
    .create-modal-grid {
      display: grid;
      gap: 14px;
      width: 100%;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    .create-modal-grid input,
    .create-modal-grid select,
    .create-modal-form input,
    .create-modal-form textarea {
      width: 100%;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      padding: 10px 12px;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    .create-modal-form textarea {
      border-radius: var(--radius-md);
      min-height: 96px;
    }
  </style>
</head>

<body>
<div class="app-shell">
  <!-- SIDEBAR -->
  <nav class="sidebar" role="navigation" aria-label="Sidebar">
    <div class="brand">
      <div class="brand-mark">CB</div>
      <div class="brand-text">
        <div class="brand-title">Calibration</div>
        <div class="brand-subtitle">Discipline - Habits - Skills</div>
      </div>
    </div>

    <div class="nav">
      <a href="{% url 'dashboard' %}" class="nav-link"><span>Dashboard</span></a>
      <a href="{% url 'disciplinebuilder' %}" class="nav-link"><span>Discipline Builder</span></a>
      <a href="{% url 'progresstracker' %}" class="nav-link"><span>Progress Tracker</span></a>
      <a href="{% url 'rewards' %}" class="nav-link"><span>Rewards</span></a>
      <a href="{% url 'messages' %}" class="nav-link{% if has_unread_messages %} has-unread{% endif %}"><span>Messages</span></a>
      <a href="{% url 'user_profile' %}" class="nav-link"><span>Profile</span></a>
      <a href="{% url 'community' %}" class="nav-link"><span>Community</span></a>
      <a href="{% url 'groups' %}" class="nav-link active"><span>Groups</span></a>
      <a href="{% url 'buddies' %}" class="nav-link"><span>Buddies</span></a>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="site-main">
    <header class="site-header">
      <div class="site-header-title">
        <h1>Groups</h1>
        <span>Create, join, and manage focused accountability spaces.</span>
      </div>
      <div class="header-actions">
        <div class="toolbar">
          <button class="btn btn-sm open-create-modal" type="button">+ New Group</button>
          <button class="profile-button" id="profile-button">
            <span class="avatar-wrap">
              <img src="https://via.placeholder.com/40x40.png" alt="User avatar">
            </span>
            <span class="gear-icon">‚öôÔ∏è</span>
          </button>
          <a class="btn btn-primary" href="/accounts/logout/">Log out</a>
        </div>
      </div>
    </header>

    <div class="site-main-inner">
      <!-- PROFILE MODAL -->
      <div class="modal-overlay" id="profile-modal" aria-hidden="true">
        <div class="modal">
          <div class="modal-header">
            <h3>Profile & Account</h3>
            <button type="button" class="modal-close" id="modal-close">&times;</button>
          </div>

          <div class="modal-body">
            <div class="profile-modal-layout">
              <article class="profile-card">
                <div class="profile-card-header">
                  <p>Welcome back</p>
                  <h4>{{ user.username }}</h4>
                  <p class="profile-tagline">Manage your Calibration account and shortcuts.</p>
                  <div class="profile-avatar-shell">
                    <img src="https://via.placeholder.com/80"
                         alt="Avatar for {{ user.username }}">
                  </div>
                </div>
                <div class="profile-card-main">
                  <div class="profile-detail-grid">
                    <div class="profile-detail-item">
                      <div class="profile-detail-label">Account</div>
                      <div class="profile-detail-value">Calibration Basic</div>
                    </div>
                    <div class="profile-detail-item">
                      <div class="profile-detail-label">Email</div>
                      <div class="profile-detail-value">
                        {{ user.email|default:"Not set" }}
                      </div>
                    </div>
                    <div class="profile-detail-item">
                      <div class="profile-detail-label">Member since</div>
                      <div class="profile-detail-value">
                        {{ user.date_joined|date:"M j, Y" }}
                      </div>
                    </div>
                    <div class="profile-detail-item">
                      <div class="profile-detail-label">Last login</div>
                      <div class="profile-detail-value">
                        {{ user.last_login|date:"M j, Y" }}
                      </div>
                    </div>
                  </div>

                  <div class="profile-quick-actions">
                    <a href="{% url 'user_profile' %}" class="p-btn p-btn-primary">View profile</a>
                    <a href="{% url 'user_settings' %}" class="p-btn p-btn-ghost">Account settings</a>
                    <a href="/accounts/logout/" class="p-btn p-btn-logout">Log out</a>
                  </div>
                </div>
              </article>

              <section class="profile-quick-links">
                <h4>Shortcuts</h4>
                <ul>
                  <li><a href="{% url 'skill_create' %}">Add a new skill</a></li>
                  <li><a href="{% url 'habit_create' %}">Create a new habit</a></li>
                  <li><a href="{% url 'rewards' %}">View your rewards</a></li>
                </ul>
                <p class="profile-footnote">
                  Use the dashboard for day-to-day tracking; this space is for account details.
                </p>
              </section>
            </div>
          </div>
        </div>
      </div>

      <!-- HERO + MINI STATS -->
      <section class="section-shell">
        <div class="hero-row">
          <article class="hero-card fade-in delay-1">
            <h2>Build your accountability universe üåê</h2>
            <p>
              Use Groups to create focused spaces around specific skills, habits,
              or long-term goals. Join what supports you and leave what doesn't.
            </p>
            <div class="pill-row">
              <div class="pill">
                <span>üîí</span><span>Private circles for deep focus</span>
              </div>
              <div class="pill">
                <span>üî•</span><span>Track streaks and shared milestones</span>
              </div>
              <div class="pill">
                <span>üö´</span><span>Mute, leave, or block any time</span>
              </div>
            </div>
            <div class="hero-actions">
              <button class="btn btn-primary btn-sm open-create-modal" type="button">+ Create new group</button>
              <a class="btn btn-sm" href="#all-groups-section">Browse all groups</a>
            </div>
          </article>

          <aside class="stats-grid fade-in delay-2">
            <div class="stat-item">
              <span class="stat-label">Groups joined</span>
              <span class="stat-value">
                {{ my_groups|length|default:0 }}
              </span>
              <span class="muted">Spaces you're currently a member of.</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Open communities</span>
              <span class="stat-value">
                {{ all_groups|length|default:0 }}
              </span>
              <span class="muted">Explore and join with one click.</span>
            </div>
          </aside>
        </div>
      </section>

      <!-- FILTER BAR + LAYOUT -->
      <section class="section-shell">
        <!-- Filter / Search bar for all groups -->
        <div class="filter-bar fade-in delay-2">
          <div class="search-wrap">
            <span class="search-icon">üîç</span>
            <input
              type="text"
              id="group-search-input"
              placeholder="Search groups by name, focus, or category..."
              autocomplete="off">
          </div>

          <div class="filter-chips">
            <button type="button" class="filter-chip active" data-filter="all">
              All
            </button>
            <button type="button" class="filter-chip" data-filter="habit">
              Habits
            </button>
            <button type="button" class="filter-chip" data-filter="skill">
              Skills
            </button>
            <button type="button" class="filter-chip" data-filter="goal">
              Goals
            </button>
            <button type="button" class="filter-chip" data-filter="private">
              Private
            </button>
            <button type="button" class="filter-chip" data-filter="public">
              Public
            </button>
          </div>
        </div>

        <div class="content-grid fade-in delay-3">
          <!-- LEFT: My Groups + Suggested -->
          <div>
            <!-- My Groups -->
            <article class="panel-card">
              <h3>My Groups</h3>
              <p class="card-subtitle">
                Spaces you're already in. Manage membership or jump into the group.
              </p>

              <ul class="group-list">
                {% if my_groups %}
                  {% for g in my_groups %}
                    <li class="group-item">
                      <div class="group-item-header">
                        <div>
                          <div class="group-name">{{ g.name }}</div>
                          <div class="group-chip-row">
                            <span class="group-chip">
                              üè∑Ô∏è {{ g.category|default:"General" }}
                            </span>
                            <span class="group-chip">
                              üë• {{ g.member_count|default:g.members.count }} member{{ g.member_count|default:g.members.count|pluralize }}
                            </span>
                            <span class="group-chip">
                              {% if g.is_private %}üîí Private{% else %}üîì Public{% endif %}
                            </span>
                          </div>
                        </div>
                      </div>

                      {% if g.description %}
                        <div class="group-meta">
                          {{ g.description|truncatechars:110 }}
                        </div>
                      {% endif %}

                      <div class="group-actions">
                        <a href="{% url 'group_detail' g.id %}" class="group-action-btn primary">
                          Open group
                        </a>

                        <form method="post" action="{% url 'group_leave' g.id %}">
                          {% csrf_token %}
                          <button type="submit" class="group-action-btn danger">
                            Leave
                          </button>
                        </form>

                        <!-- Placeholder mute / block actions (future) -->
                        <button type="button" class="group-action-btn muted" disabled>
                          Mute (soon)
                        </button>
                        <button type="button" class="group-action-btn muted" disabled>
                          Block (soon)
                        </button>
                      </div>
                    </li>
                  {% endfor %}
                {% else %}
                  <p class="group-empty">
                    You're not in any groups yet. Join a recommended group or create your own.
                  </p>
                {% endif %}
              </ul>
          </article>

          <!-- Suggested Groups -->
          <article class="panel-card" style="margin-top:16px;">
            <h3>Suggested for you</h3>
            <p class="card-subtitle">
              Based on your skills, habits, or goals.
            </p>

            <ul class="group-list">
              {% if suggested_groups %}
                {% for g in suggested_groups %}
                  <li class="group-item">
                    <div class="group-item-header">
                      <div>
                        <div class="group-name">{{ g.name }}</div>
                        <div class="group-chip-row">
                          <span class="group-chip">
                            üè∑Ô∏è {{ g.category|default:"General" }}
                          </span>
                          <span class="group-chip">
                            üë• {{ g.member_count|default:g.members.count }} member{{ g.member_count|default:g.members.count|pluralize }}
                          </span>
                        </div>
                      </div>
                    </div>
                    {% if g.description %}
                      <div class="group-meta">
                        {{ g.description|truncatechars:100 }}
                      </div>
                    {% endif %}
                    <div class="group-actions">
                      {% if g.is_member %}
                        <a href="{% url 'group_detail' g.id %}" class="group-action-btn primary">
                          Open group
                        </a>
                      {% else %}
                        <form method="post" action="{% url 'group_join' g.id %}">
                          {% csrf_token %}
                          <button type="submit" class="group-action-btn primary">
                            Join
                          </button>
                        </form>
                      {% endif %}
                    </div>
                  </li>
                {% endfor %}
              {% else %}
                <p class="group-empty">
                  No suggestions yet. Once you join or create a few groups, we'll recommend more here.
                </p>
              {% endif %}
            </ul>
          </article>
          </div>

          <!-- RIGHT: Browse All Groups -->
          <div id="all-groups-section">
            <article class="panel-card">
              <h3>Browse all groups</h3>
              <p class="card-subtitle">
                Use search and filters to find the exact kind of accountability space you need.
              </p>

              <div class="all-groups-grid" id="all-groups-grid">
                {% if all_groups %}
                  {% for g in all_groups %}
                    <div
                      class="all-group-card"
                      data-group-name="{{ g.name|lower }}"
                      data-group-category="{{ g.category|default:'general'|lower }}"
                      data-group-privacy="{% if g.is_private %}private{% else %}public{% endif %}">
                      <div class="all-group-header">
                        <div>
                          <div class="group-name">{{ g.name }}</div>
                          <div class="group-chip-row">
                            <span class="group-chip">
                              üè∑Ô∏è {{ g.category|default:"General" }}
                            </span>
                            <span class="group-chip">
                              üë• {{ g.member_count|default:g.members.count }} member{{ g.member_count|default:g.members.count|pluralize }}
                            </span>
                          </div>
                        </div>
                        <span class="badge-privacy">
                          {% if g.is_private %}üîí Private{% else %}üîì Public{% endif %}
                        </span>
                      </div>

                      {% if g.description %}
                        <div class="all-group-desc">
                          {{ g.description|truncatechars:120 }}
                        </div>
                      {% endif %}

                      <div class="all-group-actions">
                        {% if g.is_member %}
                          <a href="{% url 'group_detail' g.id %}" class="group-action-btn primary">
                            Open
                          </a>
                          <form method="post" action="{% url 'group_leave' g.id %}">
                            {% csrf_token %}
                            <button type="submit" class="group-action-btn danger">
                              Leave
                            </button>
                          </form>
                        {% else %}
                          <form method="post" action="{% url 'group_join' g.id %}">
                            {% csrf_token %}
                            <button type="submit" class="group-action-btn primary">
                              Join
                            </button>
                          </form>
                        {% endif %}
                      </div>
                    </div>
                  {% endfor %}
                {% else %}
                  <p class="group-empty">
                    No groups found. Be the first to create one!
                  </p>
                {% endif %}
              </div>
            </article>
          </div>
        </div>
      </section>
    </div>
  </main>
</div>
<!-- PROFILE MODAL JS -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Fade-in elements
    const fades = document.querySelectorAll(".fade-in");
    fades.forEach(el => {
      void el.offsetWidth;
      el.style.opacity = "1";
    });

    // Search + filter logic for all groups
    const searchInput = document.getElementById("group-search-input");
    const filterChips = document.querySelectorAll(".filter-chip");
    const allCards = document.querySelectorAll("#all-groups-grid .all-group-card");
    const createModal = document.getElementById("create-group-modal");
    const createOpeners = document.querySelectorAll(".open-create-modal");
    const createClose = document.getElementById("create-modal-close");

    let activeFilter = "all";

    function normalize(str) {
      return (str || "").toString().toLowerCase();
    }

    function applyFilters() {
      const q = normalize(searchInput ? searchInput.value : "");

      allCards.forEach(card => {
        const name = normalize(card.dataset.groupName);
        const cat  = normalize(card.dataset.groupCategory);
        const priv = normalize(card.dataset.groupPrivacy);

        let matchText = !q || name.includes(q) || cat.includes(q);

        let matchFilter = false;
        if (activeFilter === "all") {
          matchFilter = true;
        } else if (["habit", "skill", "goal", "general"].includes(activeFilter)) {
          matchFilter = (cat === activeFilter);
        } else if (activeFilter === "private" || activeFilter === "public") {
          matchFilter = (priv === activeFilter);
        }

        if (matchText && matchFilter) {
          card.classList.remove("hidden");
        } else {
          card.classList.add("hidden");
        }
      });
    }

    if (searchInput) {
      searchInput.addEventListener("input", applyFilters);
    }

    filterChips.forEach(chip => {
      chip.addEventListener("click", () => {
        const filter = chip.dataset.filter || "all";
        activeFilter = filter;
        filterChips.forEach(c => c.classList.remove("active"));
        chip.classList.add("active");
        applyFilters();
      });
    });

    // Create group modal
    if (createModal && createOpeners.length) {
      const openCreate = () => {
        createModal.classList.add("is-open");
        createModal.setAttribute("aria-hidden", "false");
      };
      const closeCreate = () => {
        createModal.classList.remove("is-open");
        createModal.setAttribute("aria-hidden", "true");
      };
      createOpeners.forEach(btn => btn.addEventListener("click", openCreate));
      if (createClose) createClose.addEventListener("click", closeCreate);
      createModal.addEventListener("click", e => { if (e.target === createModal) closeCreate(); });
      document.addEventListener("keydown", e => {
        if (e.key === "Escape" && createModal.classList.contains("is-open")) closeCreate();
      });
    }
  });
</script>

<!-- CREATE GROUP MODAL -->
<div class="modal-overlay" id="create-group-modal" aria-hidden="true">
  <div class="modal">
    <div class="modal-header">
      <h3>Create a new group</h3>
      <button type="button" class="modal-close" id="create-modal-close">&times;</button>
    </div>
    <div class="modal-body">
      <form method="post" action="{% url 'group_create' %}" class="create-modal-form">
        {% csrf_token %}
        <div class="create-modal-grid">
          <input type="text" name="name" placeholder="Group name" required>
          <select name="category">
            <option value="General">General</option>
            <option value="Habit">Habit</option>
            <option value="Skill">Skill</option>
            <option value="Goal">Goal</option>
          </select>
        </div>
        <input type="text" name="tagline" placeholder="Tagline (optional)">
        <textarea name="description" rows="3" placeholder="Description (optional)"></textarea>
        <button type="submit" class="btn btn-primary btn-sm" style="margin-top:4px;">Create group</button>
      </form>
    </div>
  </div>
</div>

{% include 'partials/profile_modal_script.html' %}
</body>
</html>
