{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ profile_user.username|default:target_user.username }} ‚Äì Profile ¬∑ Calibration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg: #eef2ff;
      --bg-soft: #e5f0ff;
      --card: #ffffff;
      --card-soft: #f3f6ff;
      --accent: #0ea5e9;
      --accent-strong: #1d4ed8;
      --accent-soft: #dbeafe;
      --text-main: #0f172a;
      --text-muted: #6b7280;
      --border-subtle: #e2e8f0;
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-pill: 999px;
      --shadow-soft: 0 16px 40px rgba(15, 23, 42, 0.12);
      --sidebar-w: 260px;
      --danger: #ef4444;
      --success: #22c55e;
    }

    *, *::before, *::after { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      min-height: 100%;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, sans-serif;
      background: radial-gradient(circle at top left, #e0f2fe 0, #eef2ff 45%, #dbeafe 100%);
      color: var(--text-main);
    }

    a { color: inherit; text-decoration: none; }

    .muted {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* APP SHELL */
    .app-shell {
      display: grid;
      grid-template-columns: var(--sidebar-w) minmax(0, 1fr);
      min-height: 100vh;
    }

    @media (max-width: 900px) {
      .app-shell {
        grid-template-columns: 1fr;
      }
    }

    /* SIDEBAR */
    .sidebar {
      background: #020617;
      color: #e5eef7;
      border-right: 1px solid rgba(148, 163, 184, 0.35);
      padding: 16px 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    @media (max-width: 900px) {
      .sidebar {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-mark {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #38bdf8, #0ea5e9 40%, #1d4ed8 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0b1120;
      font-weight: 800;
      font-size: 0.9rem;
      box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.12);
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-title {
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .brand-subtitle {
      font-size: 0.72rem;
      color: #94a3b8;
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 4px;
    }

    @media (max-width: 900px) {
      .nav {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: flex-end;
        gap: 6px;
      }
    }

    .nav-link {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 0.86rem;
      color: #cbd5f5;
      border: 1px solid transparent;
      transition: background 0.18s ease, color 0.18s ease, border-color 0.18s ease;
      position: relative;
    }

    .nav-indicator {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: transparent;
    }

    .nav-link:hover {
      background: rgba(15, 23, 42, 0.9);
      border-color: rgba(148, 163, 184, 0.6);
      color: #f9fafb;
    }

    .nav-link.has-unread::after {
      content: "";
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--danger);
      position: absolute;
      top: 6px;
      right: 8px;
      box-shadow: 0 0 0 3px rgba(239,68,68,0.25);
    }

    /* MAIN LAYOUT */
    .site-main {
      padding-bottom: 40px;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }

    .site-header {
      padding: 16px 24px 14px;
      border-bottom: 1px solid rgba(226, 232, 240, 0.95);
      background: rgba(248, 250, 252, 0.96);
      backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    @media (max-width: 640px) {
      .site-header {
        flex-wrap: wrap;
        padding: 12px 16px;
      }
    }

    .site-header-title h1 {
      margin: 0;
      font-size: 1.05rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .site-header-title span {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .header-actions {
      display: inline-flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 7px 12px;
      border-radius: var(--radius-pill);
      font-size: 0.8rem;
      font-weight: 500;
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      color: #0f172a;
      cursor: pointer;
      transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease;
    }

    .btn-sm {
      padding: 4px 9px;
      font-size: 0.76rem;
    }

    .btn:hover {
      background: #f9fafb;
      box-shadow: 0 6px 16px rgba(15,23,42,0.12);
      transform: translateY(-1px);
    }

    .btn-primary {
      border-color: transparent;
      background: linear-gradient(135deg, #0ea5e9, #1d4ed8);
      color: #eff6ff;
      box-shadow: 0 10px 25px rgba(30, 64, 175, 0.45);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #0284c7, #1e40af);
    }

    .btn-ghost {
      background: #f9fafb;
    }

    /* PROFILE PAGE SHELL */
    .profile-page {
      padding: 16px 20px;
    }

    @media (max-width: 640px) {
      .profile-page {
        padding: 12px 10px;
      }
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
    }

    /* COVER + HEADER */
    .profile-cover {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius-lg);
      margin-bottom: 12px;
      background: radial-gradient(circle at 0% 0%, #38bdf8 0, #1d4ed8 40%, #020617 100%);
      color: #e5edff;
    }

    .profile-cover-banner {
      height: 180px;
      background-image: linear-gradient(120deg, rgba(56,189,248,0.8), rgba(37,99,235,0.9)), url("{% static 'img/calibration-cover-pattern.svg' %}");
      background-size: cover;
      background-position: center;
      position: relative;
    }

    .profile-cover-overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 10% 0%, rgba(191,219,254,0.4), transparent 55%);
      opacity: 0.85;
      pointer-events: none;
    }

    .profile-main-row {
      display: grid;
      grid-template-columns: minmax(0, 2.4fr) minmax(0, 1.6fr);
      gap: 16px;
      padding: 0 20px 16px;
      transform: translateY(-40px);
    }

    @media (max-width: 780px) {
      .profile-main-row {
        grid-template-columns: minmax(0, 1fr);
        transform: translateY(-30px);
        padding: 0 14px 14px;
      }
    }

    .profile-ident-row {
      display: flex;
      gap: 14px;
      align-items: flex-end;
    }

    .profile-avatar-wrap {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 999px;
      border: 4px solid #e5edff;
      overflow: hidden;
      box-shadow: 0 18px 32px rgba(15, 23, 42, 0.6);
      background: #0b1120;
      flex-shrink: 0;
    }

    .profile-avatar-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .profile-name-meta {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding-bottom: 6px;
    }

    .profile-name-meta h2 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.02em;
    }

    .profile-tagline {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.82rem;
      align-items: center;
    }

    .profile-pill {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.4);
      border: 1px solid rgba(191, 219, 254, 0.8);
      font-size: 0.76rem;
    }

    .profile-bio {
      font-size: 0.84rem;
      max-width: 420px;
      color: #e0edff;
    }

    .profile-actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-end;
      align-items: flex-end;
      padding-bottom: 6px;
    }

    .profile-stats-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 10px;
      font-size: 0.8rem;
    }

    .profile-stat-pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.5);
      border: 1px solid rgba(191,219,254,0.7);
      display: inline-flex;
      gap: 6px;
      align-items: center;
    }

    .profile-stat-label {
      opacity: 0.8;
    }

    .profile-stat-value {
      font-weight: 600;
    }

    /* SUB NAV */
    .profile-subnav-wrap {
      padding: 0 20px 12px;
      margin-top: -22px;
    }

    @media (max-width: 780px) {
      .profile-subnav-wrap {
        padding: 0 14px 12px;
        margin-top: -12px;
      }
    }

    .profile-subnav {
      background: rgba(248,250,252,0.98);
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 8px 20px rgba(15,23,42,0.08);
      padding: 4px;
      display: inline-flex;
      gap: 4px;
      position: relative;
      max-width: 100%;
      overflow-x: auto;
    }

    .profile-subnav::-webkit-scrollbar {
      height: 6px;
    }

    .profile-subnav-btn {
      border: none;
      background: transparent;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.8rem;
      color: var(--text-muted);
      cursor: pointer;
      white-space: nowrap;
      position: relative;
      transition: color 0.16s ease, background 0.16s ease;
    }

    .profile-subnav-btn.active {
      background: linear-gradient(135deg, #0ea5e9, #1d4ed8);
      color: #eff6ff;
      box-shadow: 0 6px 14px rgba(37,99,235,0.4);
    }

    /* BODY: TWO COLUMNS */
    .profile-body {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.8fr);
      gap: 18px;
      margin-top: 16px;
    }

    @media (max-width: 980px) {
      .profile-body {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .profile-col-left, .profile-col-right {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .section-heading {
      font-size: 0.9rem;
      font-weight: 600;
      margin: 0 0 4px;
    }

    .section-subtext {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin: 0 0 8px;
    }

    /* ABOUT CARD */
    .about-card {
      padding: 12px 14px;
    }

    .about-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .about-item {
      display: flex;
      gap: 6px;
      font-size: 0.82rem;
    }

    .about-label {
      min-width: 80px;
      color: var(--text-muted);
    }

    /* FOCUS / SKILLS SUMMARY */
    .mini-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    @media (max-width: 640px) {
      .mini-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .mini-card {
      border-radius: var(--radius-md);
      padding: 10px;
      background: var(--card-soft);
      border: 1px solid #dbeafe;
      font-size: 0.8rem;
    }

    .mini-card-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .pill {
      padding: 3px 8px;
      border-radius: 999px;
      background: #eff6ff;
      border: 1px solid #dbeafe;
      font-size: 0.76rem;
      color: #1e3a8a;
    }

    /* BADGES */
    .badge-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .badge-chip {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px dashed #bfdbfe;
      background: #eff6ff;
      font-size: 0.76rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    /* GROUPS */
    .group-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 4px;
      font-size: 0.8rem;
    }

    .group-item {
      padding: 6px 8px;
      border-radius: 10px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .group-meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .group-name {
      font-weight: 600;
    }

    /* BUDDIES MINI */
    .buddies-mini-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    .buddy-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #eef2ff;
      border: 1px solid #c7d2fe;
      font-size: 0.78rem;
    }

    .buddy-avatar {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: #4f46e5;
      color: #eef2ff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.76rem;
      font-weight: 600;
    }

    /* RIGHT COL: TIMELINE (READ ONLY) */
    .feed-card {
      padding: 10px 14px;
    }

    .feed-empty {
      font-size: 0.84rem;
      color: var(--text-muted);
    }

    .feed-item {
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
      margin-bottom: 8px;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.25s ease, transform 0.25s ease;
    }

    .feed-item.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .feed-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      margin-bottom: 4px;
    }

    .feed-title {
      font-weight: 600;
    }

    .feed-meta {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .feed-body {
      font-size: 0.84rem;
      margin-top: 4px;
    }

    .feed-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      font-size: 0.76rem;
    }

    .tag-chip {
      padding: 3px 8px;
      border-radius: 999px;
      background: #e0f2fe;
      border: 1px solid #bae6fd;
      color: #075985;
    }

    /* RIGHT: BUDDIES + LIVE ACTIVITY */
    .friends-card {
      padding: 10px 14px;
    }

    .friends-header,
    .activity-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .friends-list-scroll {
      max-height: 180px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .friend-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px solid #e5e7eb;
      font-size: 0.8rem;
    }

    .friend-row:last-child {
      border-bottom: none;
    }

    .friend-avatar {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: #4f46e5;
      color: #eef2ff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .friend-name {
      font-weight: 600;
    }

    .friend-status {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .activity-card {
      padding: 10px 14px;
    }

    .activity-stream {
      max-height: 200px;
      overflow-y: auto;
      padding-right: 4px;
      font-size: 0.8rem;
    }

    .activity-item {
      padding: 7px 8px;
      border-radius: 10px;
      background: #f8fafc;
      border: 1px solid #e5e7eb;
      margin-bottom: 6px;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 0.25s ease, transform 0.25s ease;
    }

    .activity-item.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .activity-item-title {
      font-weight: 500;
      margin-bottom: 2px;
    }

    .activity-item-meta {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      color: var(--text-muted);
      font-size: 0.76rem;
    }

    .chip {
      padding: 2px 7px;
      border-radius: 999px;
      background: #dbeafe;
      color: #1e3a8a;
      font-size: 0.75rem;
    }

    /* REVEAL */
    .reveal {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.45s ease, transform 0.45s ease;
    }

    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body>
<div class="app-shell">
  <!-- SIDEBAR -->
  <nav class="sidebar" aria-label="Sidebar">
    <div class="brand">
      <div class="brand-mark">CB</div>
      <div class="brand-text">
        <div class="brand-title">Calibration</div>
        <div class="brand-subtitle">Discipline ‚Ä¢ Habits ‚Ä¢ Skills</div>
      </div>
    </div>

    <div class="nav">
      <a href="{% url 'dashboard' %}" class="nav-link">
        <span>Dashboard</span><span class="nav-indicator"></span>
      </a>
      <a href="{% url 'disciplinebuilder' %}" class="nav-link">
        <span>Discipline Builder</span><span class="nav-indicator"></span>
      </a>
      <a href="{% url 'progresstracker' %}" class="nav-link">
        <span>Progress Tracker</span><span class="nav-indicator"></span>
      </a>
      <a href="{% url 'rewards' %}" class="nav-link">
        <span>Rewards</span><span class="nav-indicator"></span>
      </a>
      <a href="{% url 'coaching' %}" class="nav-link">
        <span>Coaching</span><span class="nav-indicator"></span>
      </a>
      <a href="{% url 'messages' %}" class="nav-link{% if has_unread_messages %} has-unread{% endif %}">
        <span>Messages</span><span class="nav-indicator"></span>
      </a>
      <a href="{% url 'community' %}" class="nav-link">
        <span>Community</span><span class="nav-indicator"></span>
      </a>
      <!-- This "Profile" link still points to *your* profile -->
      <a href="{% url 'user_profile' %}" class="nav-link">
      <span>Profile</span><span class="nav-indicator"></span>
      </a>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="site-main">
    <div class="container">
      <header class="site-header">
        <div class="site-header-title">
          <h1>Profile</h1>
          <span>Viewing {{ profile_user.username }}‚Äôs Calibration identity.</span>
        </div>
        <div class="header-actions">
          <a href="{% url 'dashboard' %}" class="btn btn-ghost">‚Üê Back</a>
          <a href="{% url 'messages' %}" class="btn btn-primary">Open Messages</a>
        </div>
      </header>

      <section class="profile-page">
        <!-- COVER / HEADER -->
        <div class="profile-cover card reveal" id="profile-cover">
          <div class="profile-cover-banner">
            <div class="profile-cover-overlay"></div>
          </div>
          <div class="profile-main-row">
            <div>
              <div class="profile-ident-row">
                <div class="profile-avatar-wrap">
                  {% if profile.profile_picture %}
                    <img src="{{ profile.profile_picture.url }}" alt="{{ profile_user.username }} avatar">
                  {% else %}
                    <img src="https://via.placeholder.com/200" alt="{{ profile_user.username }} avatar">
                  {% endif %}
                </div>
                <div class="profile-name-meta">
                  <h2>{{ profile_user.username }}</h2>
                  <div class="profile-tagline">
                    <span id="greeting-label">Good day</span>
                    <span>¬∑</span>
                    <span>Calibrating habits & skills</span>
                    <span class="profile-pill">Member since {{ profile_user.date_joined|date:"M Y" }}</span>
                  </div>
                  <p class="profile-bio">
                    {% if profile.bio %}
                      {{ profile.bio }}
                    {% else %}
                      Focused on consistent habits, long-term growth, and building skills that compound over time.
                    {% endif %}
                  </p>
                </div>
              </div>

              <div class="profile-stats-row">
                <div class="profile-stat-pill">
                  <span class="profile-stat-label">Total XP</span>
                  <span class="profile-stat-value">{{ total_xp|default:0 }}</span>
                </div>
                <div class="profile-stat-pill">
                  <span class="profile-stat-label">Streak</span>
                  <span class="profile-stat-value">{{ login_streak|default:0 }} days</span>
                </div>
                <div class="profile-stat-pill">
                  <span class="profile-stat-label">Skills</span>
                  <span class="profile-stat-value">{{ skills_count|default:0 }}</span>
                </div>
                <div class="profile-stat-pill">
                  <span class="profile-stat-label">Buddies</span>
                  <span class="profile-stat-value">{{ friends|length|default:0 }}</span>
                </div>
              </div>
            </div>

            <div class="profile-actions-row">
              <button type="button" class="btn btn-ghost btn-sm" id="btn-scroll-timeline">Timeline</button>
              <button type="button" class="btn btn-ghost btn-sm" id="btn-scroll-about">About</button>
              <a href="{% url 'messages' %}" class="btn btn-primary btn-sm">
                ‚úâÔ∏è Message (inbox)
              </a>
            </div>
          </div>

          <div class="profile-subnav-wrap">
            <div class="profile-subnav" id="profile-subnav">
              <button class="profile-subnav-btn active" data-section="section-timeline">Timeline</button>
              <button class="profile-subnav-btn" data-section="section-about">About</button>
              <button class="profile-subnav-btn" data-section="section-growth">Growth</button>
              <button class="profile-subnav-btn" data-section="section-buddies">Buddies</button>
            </div>
          </div>
        </div>

        <!-- BODY -->
        <div class="profile-body">
          <!-- LEFT COLUMN -->
          <div class="profile-col-left">
            <!-- ABOUT PANEL -->
            <article class="card about-card reveal profile-section" id="section-about">
              <h2 class="section-heading">About</h2>
              <p class="section-subtext">Basic info for this Calibration profile.</p>
              <div class="about-row">
                <div class="about-item">
                  <div class="about-label">Name</div>
                  <div>{{ profile_user.get_full_name|default:profile_user.username }}</div>
                </div>
                <div class="about-item">
                  <div class="about-label">Timezone</div>
                  <div>Not shared</div>
                </div>
                <div class="about-item">
                  <div class="about-label">Focus</div>
                  <div>{{ profile.bio|default:"Discipline & skill-building" }}</div>
                </div>
                <div class="about-item">
                  <div class="about-label">Joined</div>
                  <div>{{ profile_user.date_joined|date:"F j, Y" }}</div>
                </div>
              </div>
            </article>

            <!-- FOCUS / SKILLS SUMMARY -->
            <article class="card about-card reveal profile-section" id="section-growth">
              <h2 class="section-heading">Focus Areas</h2>
              <p class="section-subtext">Where {{ profile_user.username }} has been building lately.</p>
              <div class="mini-grid">
                <div class="mini-card">
                  <div class="mini-card-title">Top Skills</div>
                  <div class="pill-row">
                    {% for s in skills_data|slice:":4" %}
                      <span class="pill">{{ s.name }} ¬∑ L{{ s.level }}</span>
                    {% empty %}
                      <span class="muted">{{ profile_user.username }} hasn‚Äôt added skills yet.</span>
                    {% endfor %}
                  </div>
                </div>
                <div class="mini-card">
                  <div class="mini-card-title">Core Habits</div>
                  <div class="pill-row">
                    {% for h in habits_data|slice:":4" %}
                      <span class="pill">{{ h.name }}</span>
                    {% empty %}
                      <span class="muted">{{ profile_user.username }} hasn‚Äôt added habits yet.</span>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </article>

            <!-- BADGES -->
            <article class="card about-card reveal">
              <h2 class="section-heading">Badges</h2>
              <p class="section-subtext">Visible milestones unlocked by this user.</p>
              <div class="badge-grid">
                <div class="badge-chip">üîê Profile Created</div>
                {% if skills_count|default:0 > 0 %}
                  <div class="badge-chip">üèÅ First Skill</div>
                {% endif %}
                {% if login_streak|default:0 >= 7 %}
                  <div class="badge-chip">üî• 7-day Streak</div>
                {% endif %}
                {% if login_streak|default:0 >= 30 %}
                  <div class="badge-chip">üåï 30-day Streak</div>
                {% endif %}
              </div>
            </article>

            <!-- GROUPS / FUTURE COMMUNITIES -->
            <article class="card about-card reveal">
              <h2 class="section-heading">Groups</h2>
              <p class="section-subtext">
                Calibration groups based on skills, habits, or goals (preview only).
              </p>
              <div class="group-list">
                <div class="group-item">
                  <div class="group-meta">
                    <span class="group-name">Deep Work ¬∑ Focus Circle</span>
                    <span class="muted">Focus & concentration</span>
                  </div>
                  <span class="chip">Preview</span>
                </div>
                <div class="group-item">
                  <div class="group-meta">
                    <span class="group-name">Morning Routines Club</span>
                    <span class="muted">Habits</span>
                  </div>
                  <span class="chip">Preview</span>
                </div>
              </div>
            </article>

            <!-- BUDDIES MINI -->
            <article class="card about-card reveal profile-section" id="section-buddies">
              <h2 class="section-heading">Buddies</h2>
              <p class="section-subtext">
                A quick look at some of {{ profile_user.username }}‚Äôs buddies (preview).
              </p>
              <div class="buddies-mini-list">
                {% for buddy in friends|slice:":6" %}
                  <div class="buddy-pill">
                    <div class="buddy-avatar">{{ buddy.user.username|slice:":2"|upper }}</div>
                    <span>{{ buddy.user.username }}</span>
                  </div>
                {% empty %}
                  <span class="muted">{{ profile_user.username }} has no buddies yet.</span>
                {% endfor %}
              </div>
            </article>
          </div>

          <!-- RIGHT COLUMN -->
          <div class="profile-col-right">
            <!-- READ-ONLY TIMELINE -->
            <article class="card feed-card reveal profile-section" id="section-timeline">
              <h2 class="section-heading">{{ profile_user.username }}‚Äôs Timeline</h2>
              <p class="section-subtext">
                Public activity from this account (skills, habits, and journals).
              </p>

              <div id="feed-list">
                {% if recent_activity %}
                  {% for item in recent_activity %}
                    <div class="feed-item">
                      <div class="feed-header">
                        <div>
                          <div class="feed-title">{{ item.title }}</div>
                          <div class="feed-meta">{{ item.meta }}</div>
                        </div>
                        <span class="chip">{{ item.type|default:"Activity" }}</span>
                      </div>
                      {% if item.body %}
                        <div class="feed-body">{{ item.body }}</div>
                      {% endif %}
                      <div class="feed-tags">
                        {% if item.tag %}
                          <span class="tag-chip">{{ item.tag }}</span>
                        {% endif %}
                        {% if item.mood %}
                          <span class="tag-chip">Mood: {{ item.mood }}</span>
                        {% endif %}
                      </div>
                    </div>
                  {% endfor %}
                {% else %}
                  <p class="feed-empty">
                    No public activity visible yet.
                  </p>
                {% endif %}
              </div>
            </article>

            <!-- FULL BUDDIES LIST -->
            <article class="card friends-card reveal">
              <div class="friends-header">
                <div>
                  <h2 class="section-heading">Buddies</h2>
                  <p class="section-subtext">
                    People connected to {{ profile_user.username }} in Calibration.
                  </p>
                </div>
              </div>
              <div class="friends-list-scroll">
                {% for buddy in friends %}
                  <div class="friend-row">
                    <div class="friend-avatar">{{ buddy.user.username|slice:":2"|upper }}</div>
                    <div>
                      <div class="friend-name">{{ buddy.user.username }}</div>
                      <div class="friend-status">
                        {% if buddy.user.last_login %}
                          Last seen {{ buddy.user.last_login|timesince }} ago
                        {% else %}
                          Joined recently
                        {% endif %}
                      </div>
                    </div>
                  </div>
                {% empty %}
                  <p class="muted">{{ profile_user.username }} has no buddies yet.</p>
                {% endfor %}
              </div>
            </article>

            <!-- LIVE ACTIVITY -->
            <article class="card activity-card reveal">
              <div class="activity-header">
                <div>
                  <h2 class="section-heading">Live Activity</h2>
                  <p class="section-subtext">
                    Demo stream ‚Äì later this can show their real-time habit & skill events.
                  </p>
                </div>
                <span class="chip" id="activity-clock">--:--</span>
              </div>
              <div class="activity-stream" id="activity-stream"></div>
            </article>
          </div>
        </div>
      </section>
    </div>
  </main>
</div>

<script>
  function clamp(num, min, max) {
    return Math.min(Math.max(num, min), max);
  }

  document.addEventListener("DOMContentLoaded", function () {
    /* GREETING */
    const greetingLabel = document.getElementById("greeting-label");
    const now = new Date();
    const hour = now.getHours();
    let greeting = "Good day";
    if (hour < 6) greeting = "Up late";
    else if (hour < 12) greeting = "Good morning";
    else if (hour < 18) greeting = "Good afternoon";
    else greeting = "Good evening";
    if (greetingLabel) greetingLabel.textContent = greeting;

    /* SUBNAV SWITCHING + SCROLL */
    const subnavBtns = document.querySelectorAll(".profile-subnav-btn");

    function smartScroll(target) {
      if (!target) return;
      const rect = target.getBoundingClientRect();
      const offset = rect.top + window.scrollY - 90;
      window.scrollTo({ top: offset, behavior: "smooth" });
    }

    subnavBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        const targetId = btn.getAttribute("data-section");
        subnavBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const targetEl = document.getElementById(targetId);
        smartScroll(targetEl);
      });
    });

    const scrollTimelineBtn = document.getElementById("btn-scroll-timeline");
    const scrollAboutBtn = document.getElementById("btn-scroll-about");
    const timelineSection = document.getElementById("section-timeline");
    const aboutSection = document.getElementById("section-about");

    scrollTimelineBtn && scrollTimelineBtn.addEventListener("click", () => smartScroll(timelineSection));
    scrollAboutBtn && scrollAboutBtn.addEventListener("click", () => smartScroll(aboutSection));

    /* REVEAL ON SCROLL */
    const revealEls = document.querySelectorAll(".reveal");
    if ("IntersectionObserver" in window) {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add("visible");
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.12 });

      revealEls.forEach(el => observer.observe(el));
    } else {
      revealEls.forEach(el => el.classList.add("visible"));
    }

    /* FEED ITEM ANIMATIONS */
    const feedItems = document.querySelectorAll(".feed-item");
    feedItems.forEach((item, index) => {
      setTimeout(() => {
        item.classList.add("visible");
      }, 120 + index * 80);
    });

    /* LIVE ACTIVITY DEMO */
    const activityStream = document.getElementById("activity-stream");
    const sampleActivities = [
      { title: "Completed habit: Morning planning", type: "Habit", ago: "2 min ago" },
      { title: "Logged skill: Deep Work (45 min)", type: "Skill", ago: "15 min ago" },
      { title: "Updated journal with mood 4/5", type: "Journal", ago: "40 min ago" },
      { title: "Streak hit {{ login_streak|default:0 }} days", type: "Streak", ago: "3 hrs ago" }
    ];

    function renderActivity() {
      if (!activityStream) return;
      activityStream.innerHTML = "";
      sampleActivities.forEach((item, idx) => {
        const node = document.createElement("div");
        node.className = "activity-item";
        node.innerHTML = `
          <div class="activity-item-title">${item.title}</div>
          <div class="activity-item-meta">
            <span class="chip">${item.type}</span>
            <span>${item.ago}</span>
          </div>
        `;
        activityStream.appendChild(node);
        setTimeout(() => node.classList.add("visible"), 140 + idx * 80);
      });
    }

    if (activityStream) {
      renderActivity();
      setInterval(() => {
        sampleActivities.push(sampleActivities.shift());
        renderActivity();
      }, 26000);
    }

    /* CLOCK */
    const activityClock = document.getElementById("activity-clock");
    function updateClock() {
      if (!activityClock) return;
      const d = new Date();
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      activityClock.textContent = hh + ":" + mm;
    }
    updateClock();
    setInterval(updateClock, 60000);
  });
</script>
</body>
</html>
